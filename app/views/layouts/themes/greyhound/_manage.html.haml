#cms_container
  #cms_header_wrapper
    %header#cms_header
      - if myself.id && myself.editor?
        #cms_header_tools
          #cms_header_tools_content
            %a{:href => url_for(:controller => "/account")}= "My Account".t
            <a href='#{url_for :controller => '/manage/access', :action => 'logout'}'>#{"Logout".t}
            #cms_header_return
              %a{:href => "/"}
                ✶ #{"View Site".t}
              - if @cms_return_to_site_url
                |
                %a{:href => @cms_return_to_site_url} ✶ Return to site
            = webiva_search_widget
      - elsif myself.id
        #cms_header_tools
          #cms_header_tools_content
            <a href='#{url_for :controller => '/manage/access', :action => 'logout'}'>#{"logout".t}
      #cms_logo
        %a{:href => "/website/dashboard#cms_page_title"}
          %img{:src => WEBIVA_LOGO_FILE || theme_src("framework/logo.png")}/
      %nav#cms_menu
        %ul
          = render_webiva_menu(@menu,@cms_page_info[:section])
  #cms_breadcrumbs
    = render_webiva_breadcrumbs(@cms_page_info)
  #cms_main_body
    - if flash[:notice]
      #flash_notice.flash_notice
        %div
          = flash[:notice]
          %a{:href => "javascript:void(0);", :onclick => "new Effect.Fade('flash_notice', { duration: 0.5 });"} (Close Notice)
    = render :partial => '/file/still_downloading'
    %h1= render_webiva_title(@cms_page_info[:title].is_a?(Array) ? @cms_page_info[:title][-1] : @cms_page_info[:title])
    - if @cms_titlebar_handlers && @cms_titlebar_handlers.length > 0
      != @cms_titlebar_handlers.map { |h| h.titlebar_html }.join("")
    = render :partial => '/layouts/wizard_top' if @wizard
    %div{:id => "cms_#{@cms_page_info[:section]}_content"}
      = yield
    = render :partial => '/layouts/wizard_bottom' if @wizard
:javascript
  $j(document).scroll(function(d) {
        var top = $j(document).scrollTop();
        var offset = $j("#cms_header").height();
        var diff = top - offset;
        if(diff < 0) { diff = 0; }
  
        if(diff > 0) {
            $j('header').width($j('header').width());
           $j("header").addClass('fixed_header');
        }
        else {
           $j("header").removeClass('fixed_header');
           $j('header').width('auto');
  
        }
    });
  
  
  $j(window).bind('resize',function(d) {
        var top = $j(document).scrollTop();
        var offset = $j("#cms_header").height();
        var diff = top - offset;
        if(diff < 0) { diff = 0; }
  
        if(diff > 0) {
           $j("header").removeClass('fixed_header');
           $j('header').width('auto');
            $j('header').width($j('header').width());
           $j("header").addClass('fixed_header');
        }
        else {
           $j("header").removeClass('fixed_header');
           $j('header').width('auto');
  
        }
    });
  
  
  
